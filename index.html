<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Сообщения">
<meta name="theme-color" content="#0C0C0C">
<title>Сообщения</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: #0C0C0C; font-family: 'Roboto', sans-serif; color: #F1F1F1; overflow: hidden; }
  ::-webkit-scrollbar { width: 3px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

  #app { height: 100vh; height: 100dvh; display: flex; flex-direction: column; max-width: 480px; margin: 0 auto; position: relative; overflow: hidden; }

  /* Status bar */
  .status-bar { background: #111; padding: 10px 20px 6px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
  .status-time { font-size: 13px; font-weight: 600; }
  .status-icons { display: flex; gap: 6px; align-items: center; }
  .battery { width: 22px; height: 11px; border: 1.5px solid #F1F1F1; border-radius: 3px; padding: 1.5px; display: flex; align-items: center; }
  .battery-fill { width: 75%; height: 100%; background: #00C853; border-radius: 1.5px; }

  /* Screens */
  .screen { display: none; flex-direction: column; flex: 1; overflow: hidden; }
  .screen.active { display: flex; }

  /* List screen */
  .list-header { background: #1A1A1A; padding: 14px 20px 12px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #222; flex-shrink: 0; }
  .list-header h1 { font-size: 22px; font-weight: 700; letter-spacing: -0.3px; }
  .list-header-icons { display: flex; gap: 14px; }
  .icon-btn { background: none; border: none; cursor: pointer; color: #9E9E9E; padding: 6px; display: flex; align-items: center; }

  .chat-list { flex: 1; overflow-y: auto; background: #1A1A1A; }
  .chat-item { display: flex; align-items: center; gap: 14px; padding: 14px 20px; cursor: pointer; background: #1A1A1A; border-bottom: 1px solid #222; transition: background 0.15s; user-select: none; }
  .chat-item:active { background: #222; }
  .chat-item:last-child { border-bottom: none; }

  .avatar { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 19px; font-weight: 700; color: #fff; flex-shrink: 0; }
  .avatar-4000 { background: linear-gradient(135deg, #1A73E8, #0D47A1); }
  .avatar-4002 { background: linear-gradient(135deg, #00897B, #004D40); }

  .chat-info { flex: 1; min-width: 0; }
  .chat-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .chat-name { font-weight: 500; font-size: 16px; }
  .chat-name.unread { font-weight: 700; }
  .chat-time { font-size: 12px; color: #9E9E9E; }
  .chat-time.unread { color: #1A73E8; font-weight: 600; }
  .chat-bottom { display: flex; justify-content: space-between; align-items: center; }
  .chat-preview { font-size: 14px; color: #9E9E9E; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: calc(100% - 28px); }
  .chat-preview.unread { color: #F1F1F1; font-weight: 500; }
  .unread-badge { background: #1A73E8; color: #fff; border-radius: 12px; min-width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; padding: 0 4px; }

  /* FAB */
  .fab { position: fixed; bottom: 28px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #1A73E8, #1557B0); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(26,115,232,0.45); z-index: 10; }
  @media (min-width: 480px) { .fab { right: calc(50% - 220px); } }

  /* Chat screen */
  .chat-header { background: #1A1A1A; padding: 10px 16px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #222; flex-shrink: 0; }
  .back-btn { background: none; border: none; cursor: pointer; color: #9E9E9E; padding: 4px 2px; display: flex; }
  .header-info { flex: 1; }
  .header-name { font-weight: 600; font-size: 17px; }
  .header-status { font-size: 12px; color: #9E9E9E; transition: color 0.3s; }
  .header-status.typing { color: #00C853; }
  .header-actions { display: flex; gap: 10px; }

  /* Messages */
  .messages-area { flex: 1; overflow-y: auto; padding: 16px 14px; display: flex; flex-direction: column; gap: 2px; background: #0C0C0C; }
  .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 12px; opacity: 0.5; }
  .empty-icon { width: 64px; height: 64px; border-radius: 50%; background: #1A1A1A; display: flex; align-items: center; justify-content: center; }
  .empty-text { color: #9E9E9E; font-size: 15px; }

  .msg-time-label { text-align: center; font-size: 11px; color: #9E9E9E; margin: 10px 0 6px; font-weight: 500; }
  .msg-row { display: flex; }
  .msg-row.me { justify-content: flex-end; }
  .msg-row.them { justify-content: flex-start; }

  .bubble { max-width: 78%; padding: 10px 14px; margin-bottom: 2px; }
  .bubble.me { background: linear-gradient(135deg, #1A73E8, #1557B0); border-radius: 18px 18px 4px 18px; box-shadow: 0 2px 8px rgba(26,115,232,0.3); }
  .bubble.them { background: #2A2A2A; border-radius: 18px 18px 18px 4px; }

  .bubble-text { font-size: 15px; line-height: 2.0; color: #F1F1F1; white-space: pre-wrap; word-break: break-word; }
  .bubble.me .bubble-text { color: #fff; }

  .bubble-meta { display: flex; align-items: center; justify-content: flex-end; gap: 4px; margin-top: 4px; }
  .bubble-time { font-size: 11px; color: rgba(255,255,255,0.65); }
  .bubble.them .bubble-time { color: #9E9E9E; }

  /* Typing indicator */
  .typing-row { display: flex; justify-content: flex-start; padding: 4px 0; }
  .typing-bubble { background: #2A2A2A; border-radius: 18px; padding: 10px 14px; display: flex; gap: 5px; align-items: center; }
  .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: #888; animation: bounce 1.2s infinite; }
  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-5px)} }

  /* Fade in */
  @keyframes fadeInUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
  .fade-in { animation: fadeInUp 0.25s ease both; }

  /* Input bar */
  .input-bar { background: #1A1A1A; border-top: 1px solid #222; padding: 10px 14px 20px; flex-shrink: 0; display: flex; align-items: flex-end; gap: 10px; }
  .input-wrap { flex: 1; background: #2A2A2A; border-radius: 22px; padding: 10px 16px; min-height: 42px; display: flex; align-items: center; }
  .msg-input { background: none; border: none; resize: none; width: 100%; color: #F1F1F1; font-size: 16px; font-family: 'Roboto', sans-serif; line-height: 1.4; max-height: 100px; overflow-y: auto; outline: none; }
  .msg-input::placeholder { color: #666; }
  .send-btn { width: 44px; height: 44px; border-radius: 50%; background: #2A2A2A; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
  .send-btn.active { background: linear-gradient(135deg, #1A73E8, #1557B0); box-shadow: 0 2px 8px rgba(26,115,232,0.4); }
</style>
</head>
<body>
<div id="app">
  <!-- Status Bar -->
  <div class="status-bar">
    <span class="status-time" id="statusTime">00:00</span>
    <div class="status-icons">
      <svg width="16" height="12" viewBox="0 0 16 12" fill="#F1F1F1"><rect x="0" y="4" width="3" height="8" rx="1"/><rect x="4.5" y="2.5" width="3" height="9.5" rx="1"/><rect x="9" y="1" width="3" height="11" rx="1"/><rect x="13.5" y="0" width="2.5" height="12" rx="1" opacity="0.3"/></svg>
      <svg width="16" height="12" viewBox="0 0 18 12" fill="#F1F1F1"><path d="M9 2C11.5 2 13.8 3.1 15.4 4.8L17 3.2C14.9 1.2 12.1 0 9 0S3.1 1.2 1 3.2L2.6 4.8C4.2 3.1 6.5 2 9 2z"/><path d="M9 6c1.4 0 2.7.6 3.6 1.5L14.2 6C12.8 4.7 11 4 9 4S5.2 4.7 3.8 6L5.4 7.5C6.3 6.6 7.6 6 9 6z"/><circle cx="9" cy="10" r="2"/></svg>
      <div class="battery"><div class="battery-fill"></div></div>
    </div>
  </div>

  <!-- LIST SCREEN -->
  <div class="screen active" id="listScreen">
    <div class="list-header">
      <h1>Сообщения</h1>
      <div class="list-header-icons">
        <button class="icon-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
        </button>
        <button class="icon-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
        </button>
      </div>
    </div>
    <div class="chat-list" id="chatList"></div>
    <button class="fab">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
    </button>
  </div>

  <!-- CHAT SCREEN -->
  <div class="screen" id="chatScreen">
    <div class="chat-header">
      <button class="back-btn" id="backBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
      </button>
      <div id="chatAvatar" class="avatar" style="width:40px;height:40px;font-size:15px;"></div>
      <div class="header-info">
        <div class="header-name" id="chatName"></div>
        <div class="header-status" id="chatStatus">Мобильный телефон</div>
      </div>
      <div class="header-actions">
        <button class="icon-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
        </button>
        <button class="icon-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
        </button>
      </div>
    </div>
    <div class="messages-area" id="messagesArea"></div>
    <div class="input-bar">
      <button class="icon-btn" style="padding:8px 4px;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 5H4v14l9.29-9.29c.39-.39 1.02-.39 1.41 0L20 15.01V5zm-9 8.17L7.83 17H4v-1l.01-.01L11 9.17zM20 19H8.83l4-4L20 21.01V19zM2 3v18h18V3H2z"/></svg>
      </button>
      <div class="input-wrap">
        <textarea class="msg-input" id="msgInput" rows="1" placeholder="Сообщение"></textarea>
      </div>
      <button class="send-btn" id="sendBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="#555" id="sendIcon">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
// ─── State ───────────────────────────────────────────────────────────────────
const INITIAL_TICKET = 235893;
const TICKET_INCREMENT = 634;

let state = {
  ticket: INITIAL_TICKET,
  msgs4000: [],
  msgs4002: [],
  unread4002: 0,
  currentChat: null
};

// ─── Storage helpers ─────────────────────────────────────────────────────────
function save(key, value) {
  try { localStorage.setItem(key, JSON.stringify(value)); } catch(e) {}
}
function load(key, def) {
  try { const v = localStorage.getItem(key); return v !== null ? JSON.parse(v) : def; } catch(e) { return def; }
}

function loadState() {
  state.ticket    = load('rtec_ticket', INITIAL_TICKET);
  state.msgs4000  = load('rtec_msgs4000', []);
  state.msgs4002  = load('rtec_msgs4002', []);
  state.unread4002= load('rtec_unread4002', 0);
}

function saveAll() {
  save('rtec_ticket',     state.ticket);
  save('rtec_msgs4000',   state.msgs4000);
  save('rtec_msgs4002',   state.msgs4002);
  save('rtec_unread4002', state.unread4002);
}

// ─── Formatting ──────────────────────────────────────────────────────────────
function padTicket(n) { return n.toString().padStart(9, '0'); }

function fmtFull(iso) {
  const d = new Date(iso);
  const dd = d.getDate().toString().padStart(2,'0');
  const mm = (d.getMonth()+1).toString().padStart(2,'0');
  const yy = d.getFullYear();
  const HH = d.getHours().toString().padStart(2,'0');
  const MM = d.getMinutes().toString().padStart(2,'0');
  return `${dd}.${mm}.${yy}  ${HH}:${MM}`;
}

function fmtTime(iso) {
  const d = new Date(iso);
  return d.getHours().toString().padStart(2,'0') + ':' + d.getMinutes().toString().padStart(2,'0');
}

function fmtListTime(iso) {
  const d = new Date(iso);
  const now = new Date();
  if (d.toDateString() === now.toDateString()) return fmtTime(iso);
  return d.getDate().toString().padStart(2,'0') + '.' + (d.getMonth()+1).toString().padStart(2,'0');
}

// ─── Status clock ─────────────────────────────────────────────────────────────
function updateClock() {
  const now = new Date();
  document.getElementById('statusTime').textContent =
    now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
}
updateClock();
setInterval(updateClock, 10000);

// ─── Chat list rendering ──────────────────────────────────────────────────────
function renderList() {
  const chats = [
    { id: '4000', msgs: state.msgs4000, unread: 0 },
    { id: '4002', msgs: state.msgs4002, unread: state.unread4002 }
  ].sort((a,b) => {
    const la = a.msgs[a.msgs.length-1];
    const lb = b.msgs[b.msgs.length-1];
    const ta = la ? new Date(la.time).getTime() : 0;
    const tb = lb ? new Date(lb.time).getTime() : 0;
    return tb - ta;
  });

  const list = document.getElementById('chatList');
  list.innerHTML = chats.map(c => {
    const last = c.msgs[c.msgs.length - 1];
    const preview = last
      ? (last.from === 'me' ? 'Вы: ' : '') + last.text.split('\n')[0]
      : 'Нет сообщений';
    const time = last ? fmtListTime(last.time) : '';
    const hasUnread = c.unread > 0;
    return `
      <div class="chat-item" onclick="openChat('${c.id}')">
        <div class="avatar avatar-${c.id}">${c.id.slice(-2)}</div>
        <div class="chat-info">
          <div class="chat-top">
            <span class="chat-name${hasUnread?' unread':''}">${c.id}</span>
            <span class="chat-time${hasUnread?' unread':''}">${time}</span>
          </div>
          <div class="chat-bottom">
            <span class="chat-preview${hasUnread?' unread':''}">${escHtml(preview)}</span>
            ${hasUnread ? `<div class="unread-badge">${c.unread}</div>` : ''}
          </div>
        </div>
      </div>`;
  }).join('');
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// ─── Open / close chat ────────────────────────────────────────────────────────
function openChat(id) {
  state.currentChat = id;
  if (id === '4002') {
    state.unread4002 = 0;
    save('rtec_unread4002', 0);
  }
  document.getElementById('chatName').textContent = id;
  const av = document.getElementById('chatAvatar');
  av.className = `avatar avatar-${id}`;
  av.textContent = id.slice(-2);
  document.getElementById('msgInput').placeholder = id === '4000' ? 'Введите 4 цифры...' : 'Сообщение';

  document.getElementById('listScreen').classList.remove('active');
  document.getElementById('chatScreen').classList.add('active');

  renderMessages();
  scrollBottom();
  setTimeout(() => document.getElementById('msgInput').focus(), 200);
}

document.getElementById('backBtn').onclick = () => {
  state.currentChat = null;
  document.getElementById('chatScreen').classList.remove('active');
  document.getElementById('listScreen').classList.add('active');
  renderList();
};

// ─── Messages rendering ───────────────────────────────────────────────────────
function renderMessages() {
  const msgs = state.currentChat === '4000' ? state.msgs4000 : state.msgs4002;
  const area = document.getElementById('messagesArea');

  if (msgs.length === 0) {
    area.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="#9E9E9E"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
        </div>
        <div class="empty-text">Начните переписку</div>
      </div>`;
    return;
  }

  area.innerHTML = msgs.map((msg, i) => {
    const prev = msgs[i-1];
    const showTime = !prev || (new Date(msg.time) - new Date(prev.time)) > 5*60*1000;
    const isMe = msg.from === 'me';

    const timeLabel = showTime
      ? `<div class="msg-time-label">${fmtFull(msg.time)}</div>` : '';

    const checkmark = isMe ? `
      <svg width="14" height="10" viewBox="0 0 18 12" fill="rgba(255,255,255,0.7)">
        <path d="M17.01 3.4l-1.43-1.45-6.4 6.41-3.08-3.07L4.67 6.72l4.51 4.51 1.42-1.42.74-.74 5.67-5.67z"/>
        <path d="M12.47 3.4L11.04 1.95l-4.95 4.95-.7-.7L3.96 7.63l2.13 2.13 1.42-1.42.74-.74 4.22-4.2z" opacity="0.5"/>
      </svg>` : '';

    return `
      ${timeLabel}
      <div class="msg-row ${isMe?'me':'them'} fade-in">
        <div class="bubble ${isMe?'me':'them'}">
          <div class="bubble-text">${escHtml(msg.text)}</div>
          <div class="bubble-meta">
            <span class="bubble-time">${fmtTime(msg.time)}</span>
            ${checkmark}
          </div>
        </div>
      </div>`;
  }).join('');
}

function addTyping() {
  const area = document.getElementById('messagesArea');
  const row = document.createElement('div');
  row.className = 'typing-row';
  row.id = 'typingIndicator';
  row.innerHTML = `<div class="typing-bubble"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
  area.appendChild(row);
  scrollBottom();
}

function removeTyping() {
  const el = document.getElementById('typingIndicator');
  if (el) el.remove();
}

function scrollBottom() {
  const area = document.getElementById('messagesArea');
  setTimeout(() => area.scrollTop = area.scrollHeight, 50);
}

// ─── Typing status ────────────────────────────────────────────────────────────
function setTypingStatus(on) {
  const el = document.getElementById('chatStatus');
  if (on) { el.textContent = 'печатает...'; el.classList.add('typing'); }
  else     { el.textContent = 'Мобильный телефон'; el.classList.remove('typing'); }
}

// ─── Send message ─────────────────────────────────────────────────────────────
function sendMessage() {
  const input = document.getElementById('msgInput');
  const text = input.value.trim();
  if (!text || !state.currentChat) return;
  input.value = '';
  input.style.height = 'auto';
  updateSendBtn();

  const now = new Date().toISOString();
  const userMsg = { id: 'u' + Date.now(), text, from: 'me', time: now };

  if (state.currentChat === '4000') {
    state.msgs4000.push(userMsg);
    renderMessages();
    scrollBottom();

    if (/^\d{4}$/.test(text)) {
      setTypingStatus(true);
      addTyping();
      setTimeout(() => {
        setTypingStatus(false);
        removeTyping();

        const respTime = new Date().toISOString();
        const ticketNum = padTicket(state.ticket);
        state.ticket += TICKET_INCREMENT;

        const botText = `IM RTEC\nBilet Nr MCT-${ticketNum}\n${fmtFull(respTime)}\nPret 6 MDL\nBord ${text}`;
        const botMsg = { id: 'b' + Date.now(), text: botText, from: 'them', time: respTime };
        state.msgs4000.push(botMsg);
        saveAll();
        renderMessages();
        scrollBottom();

        // Trigger 4002 message
        setTimeout(() => {
          const msg4002 = {
            id: 'c' + Date.now(),
            text: 'Plata cu succes!\n6 MDL achitati catre Regia \nTransport Electric (RTEC)',
            from: 'them',
            time: new Date().toISOString()
          };
          state.msgs4002.push(msg4002);
          if (state.currentChat !== '4002') {
            state.unread4002++;
          }
          saveAll();
          // If we're already in 4002 chat, re-render it
          if (state.currentChat === '4002') {
            renderMessages();
            scrollBottom();
          }
        }, 1200);

      }, 1400);
    } else {
      saveAll();
    }

  } else if (state.currentChat === '4002') {
    state.msgs4002.push(userMsg);
    saveAll();
    renderMessages();
    scrollBottom();
  }
}

// ─── Input handling ───────────────────────────────────────────────────────────
const msgInput = document.getElementById('msgInput');
const sendBtn  = document.getElementById('sendBtn');
const sendIcon = document.getElementById('sendIcon');

function updateSendBtn() {
  const hasText = msgInput.value.trim().length > 0;
  sendBtn.classList.toggle('active', hasText);
  sendIcon.setAttribute('fill', hasText ? 'white' : '#555');
}

msgInput.addEventListener('input', () => {
  msgInput.style.height = 'auto';
  msgInput.style.height = Math.min(msgInput.scrollHeight, 100) + 'px';
  updateSendBtn();
});

msgInput.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

sendBtn.addEventListener('click', sendMessage);

// ─── Init ─────────────────────────────────────────────────────────────────────
loadState();
renderList();
</script>
</body>
</html>
